(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{446:function(e,t,n){"use strict";n.r(t);var a=n(2),s=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"_11-åˆçº¦è°ƒç”¨åˆçº¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-åˆçº¦è°ƒç”¨åˆçº¦"}},[e._v("#")]),e._v(" 11.åˆçº¦è°ƒç”¨åˆçº¦")]),e._v(" "),t("p",[e._v("Solidity æ”¯æŒä¸€ä¸ªåˆçº¦è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ã€‚ä¸¤ä¸ªåˆçº¦æ—¢å¯ä»¥ä½äºåŒä¸€æ–‡ä»¶å†…ï¼Œä¹Ÿå¯ä»¥ä½äºä¸åŒçš„ä¸¤ä¸ªæ–‡ä»¶ä¸­ã€‚è¿˜èƒ½è°ƒç”¨å·²ç»ä¸Šé“¾çš„å…¶å®ƒåˆçº¦ã€‚")]),e._v(" "),t("ul",[t("li",[e._v("è°ƒç”¨å†…éƒ¨åˆçº¦\n"),t("ul",[t("li",[e._v("å†…éƒ¨åˆçº¦æŒ‡ï¼šä½äºåŒä¸€ sol æ–‡ä»¶ä¸­çš„åˆçº¦ï¼Œå®ƒä»¬ä¸éœ€è¦é¢å¤–çš„å£°æ˜å°±å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚")])])]),e._v(" "),t("li",[e._v("è°ƒç”¨å¤–éƒ¨åˆçº¦\n"),t("ul",[t("li",[e._v("å¤–éƒ¨åˆçº¦æŒ‡ï¼šä½äºä¸åŒæ–‡ä»¶çš„å¤–éƒ¨åˆçº¦ï¼Œä»¥åŠä¸Šé“¾çš„åˆçº¦ã€‚")]),e._v(" "),t("li",[e._v("æ–¹æ³•ä¸€: é€šè¿‡æ¥å£æ–¹å¼è°ƒç”¨")]),e._v(" "),t("li",[e._v("æ–¹æ³•äºŒ: é€šè¿‡ç­¾åæ–¹å¼è°ƒç”¨")])])])]),e._v(" "),t("p",[e._v("äº†è§£ä¸Šé¢çš„è°ƒç”¨åï¼Œå¯ä»¥æ‰©å±•äº†è§£"),t("strong",[e._v("å¤šæ¬¡è°ƒç”¨")])]),e._v(" "),t("h2",{attrs:{id:"_1ï¸âƒ£-è°ƒç”¨å†…éƒ¨åˆçº¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1ï¸âƒ£-è°ƒç”¨å†…éƒ¨åˆçº¦"}},[e._v("#")]),e._v(" 1ï¸âƒ£ è°ƒç”¨å†…éƒ¨åˆçº¦")]),e._v(" "),t("p",[e._v("åœ°å€è½¬æ¢ä¸ºåˆçº¦å¯¹è±¡çš„é˜²èŒƒï¼š")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("æ–¹æ³• 1")]),e._v(": é€šè¿‡ "),t("code",[e._v("ContractName(_ads)")]),e._v(" å°†ä¼ å…¥çš„åœ°å€ï¼Œè½¬ä¸ºåˆçº¦å¯¹è±¡\n"),t("ul",[t("li",[t("code",[e._v("Test(_ads).setX(_x);")])]),e._v(" "),t("li",[e._v("å¦‚æœä¸ºäº†ä»£ç é€»è¾‘ï¼Œä¹Ÿå¯ä»¥åˆ†å¼€å†™ï¼Œæ¯”å¦‚"),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Test temp = Test(_ads);\ntemp.setX(_x);\n")])])])])])]),e._v(" "),t("li",[t("strong",[e._v("æ–¹æ³• 2")]),e._v(": å¯ä»¥é€šè¿‡å‚æ•°ä¸­æŒ‡å®šåˆçº¦åå­—è¿›è¡Œè½¬æ¢"),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("  function setX2(Test _ads, uint256 _x) public {\n      _ads.setX(_x);\n  }\n")])])])]),e._v(" "),t("li",[t("strong",[e._v("è°ƒç”¨å¹¶å‘é€ ETH")]),e._v(": "),t("code",[e._v("fnName{value: msg.value}();")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Test(_ads).setYBySendEth{value: msg.value}();")])])])])]),e._v(" "),t("p",[e._v("ä¾‹å­æ¼”ç¤ºï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// SPDX-License-Identifier: MIT\npragma solidity ^0.8.17;\n\ncontract Test {\n    uint256 public x = 1;\n    uint256 public y = 2;\n\n    function setX(uint256 _x) public {\n        x = _x;\n    }\n\n    function getX() public view returns (uint256) {\n        return x;\n    }\n\n    function setYBySendEth() public payable {\n        y = msg.value;\n    }\n\n    function getXandY() public view returns (uint256, uint256) {\n        return (x, y);\n    }\n}\n\ncontract CallTest {\n    // ç¬¬1ç§æ–¹æ³•: 229647 / 27858 gas\n    function setX1(address _ads, uint256 _x) public {\n        Test(_ads).setX(_x);\n    }\n\n    // ç¬¬2ç§æ–¹æ³•:   27923 gas\n    function setX2(Test _ads, uint256 _x) public {\n        _ads.setX(_x);\n    }\n\n    function getX(address _ads) public view returns (uint256) {\n        return Test(_ads).getX();\n    }\n\n    function setYBySendEth(address _ads) public payable {\n        Test(_ads).setYBySendEth{value: msg.value}();\n    }\n\n    function getXandY(address _ads)\n        public\n        view\n        returns (uint256 __x, uint256 __y)\n    {\n        (__x, __y) = Test(_ads).getXandY();\n    }\n}\n")])])]),t("h2",{attrs:{id:"_2ï¸âƒ£-è°ƒç”¨å¤–éƒ¨åˆçº¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2ï¸âƒ£-è°ƒç”¨å¤–éƒ¨åˆçº¦"}},[e._v("#")]),e._v(" 2ï¸âƒ£ è°ƒç”¨å¤–éƒ¨åˆçº¦")]),e._v(" "),t("h3",{attrs:{id:"_1-é€šè¿‡æ¥å£æ–¹å¼è°ƒç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-é€šè¿‡æ¥å£æ–¹å¼è°ƒç”¨"}},[e._v("#")]),e._v(" 1. é€šè¿‡æ¥å£æ–¹å¼è°ƒç”¨")]),e._v(" "),t("p",[t("RouterLink",{attrs:{to:"/source/13.interface.html#id3"}},[e._v("æ¥å£ä½¿ç”¨æ¡ˆä¾‹")])],1),e._v(" "),t("p",[e._v("æ ¸å¿ƒä»£ç ")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("interface AnimalEat {\n    function eat() external returns (string memory);\n}\n\ncontract Animal {\n    function test(address _addr) external returns (string memory) {\n        AnimalEat general = AnimalEat(_addr);\n        return general.eat();\n    }\n}\n")])])]),t("h3",{attrs:{id:"_2-é€šè¿‡ç­¾åæ–¹å¼è°ƒç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-é€šè¿‡ç­¾åæ–¹å¼è°ƒç”¨"}},[e._v("#")]),e._v(" 2. é€šè¿‡ç­¾åæ–¹å¼è°ƒç”¨")]),e._v(" "),t("p",[e._v("é€šè¿‡ç­¾åæ–¹å¼è°ƒç”¨åˆçº¦ï¼Œåªéœ€è¦ä¼ å…¥è¢«è°ƒç”¨è€…çš„åœ°å€å’Œè°ƒç”¨æ–¹æ³•å£°æ˜ã€‚")]),e._v(" "),t("p",[e._v("åœ¨ç¬¬äºŒç« åœ°å€ç±»å‹é‚£ä¸€èŠ‚æœ‰è¯¦ç»†çš„ä»‹ç»")]),e._v(" "),t("ul",[t("li",[e._v("ä½¿ç”¨ "),t("RouterLink",{attrs:{to:"/source/02.type-of-data.html#call"}},[e._v("call")])],1),e._v(" "),t("li",[e._v("ä½¿ç”¨ "),t("RouterLink",{attrs:{to:"/source/02.type-of-data.html#delegatecall"}},[e._v("delegatecall")])],1),e._v(" "),t("li",[e._v("ä½¿ç”¨ "),t("RouterLink",{attrs:{to:"/source/02.type-of-data.html#staticcall"}},[e._v("staticcall")])],1)]),e._v(" "),t("p",[t("strong",[e._v("call æ ¸å¿ƒä»£ç å¦‚ä¸‹")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('bytes memory data = abi.encodeWithSignature(\n    "setNameAndAge(string,uint256)",\n    _name,\n    _age\n);\n(bool success, bytes memory _bys) = _ads.call{value: msg.value}(data);\nrequire(success, "Call Failed");\nbys = _bys;\n')])])]),t("p",[e._v("ç”¨ç»™å®šçš„æœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰å‘å‡ºä½çº§ "),t("code",[e._v("CALL")]),e._v(" è°ƒç”¨ï¼Œå¹¶"),t("strong",[e._v("è¿”å›äº¤æ˜“æˆåŠŸçŠ¶æ€å’Œè¿”å›æ•°æ®")]),e._v("ï¼ˆè°ƒç”¨åˆçº¦çš„æ–¹æ³•å¹¶è½¬è´¦ï¼‰, æ ¼å¼å¦‚ä¸‹ï¼š")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<address>.call(bytes memory) returns (bool, bytes memory)\n")])])]),t("p",[t("strong",[e._v("DelegateCall æ ¸å¿ƒä»£ç å¦‚ä¸‹")])]),e._v(" "),t("ul",[t("li",[e._v("å§”æ‰˜è°ƒç”¨åï¼Œæ‰€æœ‰å˜é‡ä¿®æ”¹éƒ½æ˜¯å‘ç”Ÿåœ¨å§”æ‰˜åˆçº¦å†…éƒ¨ï¼Œå¹¶ä¸ä¼šä¿å­˜åœ¨è¢«å§”æ‰˜åˆçº¦ä¸­ã€‚\n"),t("ul",[t("li",[e._v("åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥é€šè¿‡æ›´æ¢è¢«å§”æ‰˜åˆçº¦ï¼Œæ¥å‡çº§å§”æ‰˜åˆçº¦ã€‚")])])]),e._v(" "),t("li",[e._v("å§”æ‰˜è°ƒç”¨åˆçº¦å†…éƒ¨ï¼Œéœ€è¦å’Œè¢«å§”æ‰˜åˆçº¦çš„å†…éƒ¨å‚æ•°å®Œå…¨ä¸€æ ·ï¼Œå¦åˆ™å®¹æ˜“å¯¼è‡´æ•°æ®æ··ä¹±\n"),t("ul",[t("li",[e._v("å¯ä»¥é€šè¿‡é¡ºåºæ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æ¨èå®Œå…¨ä¸€æ ·")])])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('function set(address _ads, uint256 _num) external payable {\n    sender = msg.sender;\n    value = msg.value;\n    num = _num;\n    // ç¬¬1ç§ encode\n    // ä¸éœ€çŸ¥é“åˆçº¦åå­—ï¼Œå‡½æ•°å®Œå…¨è‡ªå®šä¹‰\n    bytes memory data1 = abi.encodeWithSignature("set(uint256)", _num);\n    // ç¬¬2ç§ encode\n    // éœ€è¦åˆçº¦åå­—ï¼Œå¯ä»¥é¿å…å‡½æ•°å’Œå‚æ•°å†™é”™\n    // bytes memory data2 = abi.encodeWithSelector(Test1.set.selector, _num);\n\n    (bool success, bytes memory _data) = _ads.delegatecall(data1);\n\n    require(success, "DelegateCall set failed");\n}\n')])])]),t("p",[t("strong",[e._v("staticcall æ ¸å¿ƒä»£ç å¦‚ä¸‹")]),e._v(": å®ƒä¸ call åŸºæœ¬ç›¸åŒï¼Œ"),t("strong",[e._v("ä½†å¦‚æœè¢«è°ƒç”¨çš„å‡½æ•°ä»¥ä»»ä½•æ–¹å¼ä¿®æ”¹çŠ¶æ€å˜é‡ï¼Œéƒ½å°†å›é€€")]),e._v("ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('// SPDX-License-Identifier: MIT\npragma solidity ^0.8.17;\n\n// è¢«è°ƒç”¨çš„åˆçº¦\ncontract Hello {\n    function echo() external pure returns (string memory) {\n        return "Hello World!";\n    }\n}\n\n// è°ƒç”¨è€…åˆçº¦\ncontract SoldityTest {\n    function callHello(address _ads) external view returns (string memory) {\n        // ç¼–ç è¢«è°ƒç”¨è€…çš„æ–¹æ³•ç­¾å\n        bytes4 methodId = bytes4(keccak256("echo()"));\n\n        // è°ƒç”¨åˆçº¦\n        (bool success, bytes memory data) = _ads.staticcall(\n            abi.encodeWithSelector(methodId)\n        );\n        if (success) {\n            return abi.decode(data, (string));\n        } else {\n            return "error";\n        }\n    }\n}\n')])])]),t("h2",{attrs:{id:"_3ï¸âƒ£-multicall-å¤šæ¬¡è°ƒç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3ï¸âƒ£-multicall-å¤šæ¬¡è°ƒç”¨"}},[e._v("#")]),e._v(" 3ï¸âƒ£ MultiCall/å¤šæ¬¡è°ƒç”¨")]),e._v(" "),t("ul",[t("li",[e._v("æŠŠå¤šä¸ªåˆçº¦çš„å¤šæ¬¡å‡½æ•°çš„è°ƒç”¨ï¼Œæ‰“åŒ…åœ¨ä¸€ä¸ªé‡Œé¢å¯¹åˆçº¦è¿›è¡Œè°ƒç”¨ã€‚RPC å¯¹è°ƒç”¨æœ‰é™åˆ¶ï¼Œè¿™æ ·å¯ä»¥ç»•å¼€é™åˆ¶ã€‚")]),e._v(" "),t("li",[e._v("å¤šæ¬¡è°ƒç”¨é‡Œé¢ï¼Œå¯¹æ–¹çš„å†…éƒ¨, "),t("code",[e._v("msg.sender")]),e._v(" æ˜¯ MultiCall åˆçº¦ï¼Œè€Œä¸æ˜¯ç”¨æˆ·åœ°å€ã€‚")])]),e._v(" "),t("h3",{attrs:{id:"è¯´æ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¯´æ˜"}},[e._v("#")]),e._v(" è¯´æ˜")]),e._v(" "),t("ul",[t("li",[e._v("è°ƒç”¨çš„åœ°å€")]),e._v(" "),t("li",[e._v("è°ƒç”¨çš„ data")])]),e._v(" "),t("h3",{attrs:{id:"åˆçº¦ä»£ç "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆçº¦ä»£ç "}},[e._v("#")]),e._v(" åˆçº¦ä»£ç ")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('// SPDX-License-Identifier: MIT\npragma solidity ^0.8.17;\n\ncontract Test {\n    function fn1()\n        external\n        view\n        returns (\n            uint256,\n            address,\n            uint256\n        )\n    {\n        return (1, msg.sender, block.timestamp);\n    }\n\n    function fn2()\n        external\n        view\n        returns (\n            uint256,\n            address,\n            uint256\n        )\n    {\n        return (2, msg.sender, block.timestamp);\n    }\n\n    function getFn1Data() external pure returns (bytes memory) {\n        // ä¸¤ç§ç­¾åæ–¹æ³•éƒ½å¯ä»¥\n        // abi.encodeWithSignature("fn1()");\n        return abi.encodeWithSelector(this.fn1.selector);\n    }\n\n    function getFn2Data() external pure returns (bytes memory) {\n        return abi.encodeWithSelector(this.fn2.selector);\n    }\n}\n\ncontract MultiCall {\n    function multiCall(address[] calldata targets, bytes[] calldata data)\n        external\n        view\n        returns (bytes[] memory)\n    {\n        require(targets.length == data.length, "targets.length != data.length");\n        bytes[] memory results = new bytes[](data.length);\n        for (uint256 index = 0; index < targets.length; index++) {\n            (bool success, bytes memory result) = targets[index].staticcall(\n                data[index]\n            );\n            require(success, "call faild");\n            results[index] = result;\n        }\n        return results;\n    }\n}\n')])])]),t("p",[t("strong",[e._v("æµ‹è¯•")])]),e._v(" "),t("ul",[t("li",[t("p",[e._v("éƒ¨ç½² "),t("code",[e._v("Test")]),e._v(": "),t("code",[e._v("0x1c91347f2A44538ce62453BEBd9Aa907C662b4bD")])]),e._v(" "),t("ul",[t("li",[e._v("ä½¿ç”¨ "),t("code",[e._v("getFn1Data")]),e._v(" è·å– fn1 data")]),e._v(" "),t("li",[e._v("ä½¿ç”¨ "),t("code",[e._v("getFn2Data")]),e._v(" è·å– fn2 data")])])]),e._v(" "),t("li",[t("p",[e._v("éƒ¨ç½² "),t("code",[e._v("MultiCall")]),e._v(": "),t("code",[e._v("0x93f8dddd876c7dBE3323723500e83E202A7C96CC")])])]),e._v(" "),t("li",[t("p",[e._v("è°ƒç”¨ multiCall æ–¹æ³•")]),e._v(" "),t("ul",[t("li",[e._v("å‚æ•° 1: "),t("code",[e._v('["Test åœ°å€","Test åœ°å€"]')])]),e._v(" "),t("li",[e._v("å‚æ•° 2: "),t("code",[e._v('["fn1 data","fn2 data"]')])])])]),e._v(" "),t("li",[t("p",[e._v("è¿”å›å€¼å¦‚ä¸‹")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("0x\n0000000000000000000000000000000000000000000000000000000000000001\n00000000000000000000000093f8dddd876c7dbe3323723500e83e202a7c96cc\n00000000000000000000000000000000000000000000000000000000630c7834,\n0x\n0000000000000000000000000000000000000000000000000000000000000002\n00000000000000000000000093f8dddd876c7dbe3323723500e83e202a7c96cc\n00000000000000000000000000000000000000000000000000000000630c7834\n")])])])])]),e._v(" "),t("h2",{attrs:{id:"_4ï¸âƒ£-multidelegatecall-å¤šæ¬¡å§”æ‰˜è°ƒç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4ï¸âƒ£-multidelegatecall-å¤šæ¬¡å§”æ‰˜è°ƒç”¨"}},[e._v("#")]),e._v(" 4ï¸âƒ£ MultiDelegatecall / å¤šæ¬¡å§”æ‰˜è°ƒç”¨")]),e._v(" "),t("p",[e._v("ä¸ºä»€ä¹ˆä½¿ç”¨ MultiDelegatecall ï¼Œä¸ä½¿ç”¨ MultiCall?æ˜¯ä¸ºäº†è®©è¢«è°ƒç”¨çš„åˆçº¦å†…ï¼Œ"),t("code",[e._v("msg.sender")]),e._v(" æ˜¯ç”¨æˆ·åˆçº¦ï¼Œè€Œä¸æ˜¯ä¸­è½¬åˆçº¦çš„åœ°å€ã€‚")]),e._v(" "),t("p",[e._v("ä½†æ˜¯å§”æ‰˜è°ƒç”¨çš„ç¼ºç‚¹æ˜¯ï¼Œåˆçº¦å¿…é¡»æ˜¯è‡ªå·±ç¼–å†™çš„ï¼Œä¸èƒ½æ˜¯åˆ«äººç¼–å†™çš„ã€‚")]),e._v(" "),t("p",[e._v("å¤šæ¬¡å§”æ‰˜è°ƒç”¨ï¼Œå­˜åœ¨æ¼æ´ï¼Œä¸è¦åœ¨é‡Œé¢å¤šæ¬¡ç´¯åŠ ä½™é¢ã€‚æˆ–è€…å¤šé‡å§”æ‰˜ç¦æ­¢æ¥å—èµ„é‡‘ã€‚")]),e._v(" "),t("h3",{attrs:{id:"åˆçº¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åˆçº¦"}},[e._v("#")]),e._v(" åˆçº¦")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('// SPDX-License-Identifier: MIT\npragma solidity ^0.8.17;\n\ncontract MultiDelegatecall {\n    function multiDelegatecall(bytes[] calldata data)\n        external\n        returns (bytes[] memory)\n    {\n        bytes[] memory results = new bytes[](data.length);\n        for (uint256 index = 0; index < data.length; index++) {\n            (bool success, bytes memory result) = address(this).delegatecall(\n                data[index]\n            );\n            require(success, "call faild");\n            results[index] = result;\n        }\n        return results;\n    }\n}\n\ncontract Test is MultiDelegatecall {\n    function fn1()\n        external\n        view\n        returns (\n            uint256,\n            address,\n            uint256\n        )\n    {\n        return (1, msg.sender, block.timestamp);\n    }\n\n    function fn2()\n        external\n        view\n        returns (\n            uint256,\n            address,\n            uint256\n        )\n    {\n        return (2, msg.sender, block.timestamp);\n    }\n\n    function getFn1Data() external pure returns (bytes memory) {\n        // ä¸¤ç§ç­¾åæ–¹æ³•éƒ½å¯ä»¥\n        // abi.encodeWithSignature("fn1()");\n        return abi.encodeWithSelector(this.fn1.selector);\n    }\n\n    function getFn2Data() external pure returns (bytes memory) {\n        return abi.encodeWithSelector(this.fn2.selector);\n    }\n}\n')])])]),t("p",[t("strong",[e._v("åˆçº¦æµ‹è¯•")])]),e._v(" "),t("ul",[t("li",[t("p",[e._v("éƒ¨ç½² Test åˆçº¦")])]),e._v(" "),t("li",[t("p",[e._v("è·å– getFn1Data: "),t("code",[e._v("0x648fc804")])])]),e._v(" "),t("li",[t("p",[e._v("è·å– getFn2Data: "),t("code",[e._v("0x98d26a11")])])]),e._v(" "),t("li",[t("p",[e._v("è°ƒç”¨ "),t("code",[e._v("multiDelegatecall")])]),e._v(" "),t("ul",[t("li",[e._v('["0x648fc804","0x98d26a11"]')])])]),e._v(" "),t("li",[t("p",[e._v("å¾—åˆ° decoded outputï¼Œå‘ç°åœ°å€æ˜¯ç”¨æˆ·çš„")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("0x\n0000000000000000000000000000000000000000000000000000000000000001\n0000000000000000000000005b38da6a701c568545dcfcb03fcb875f56beddc4\n00000000000000000000000000000000000000000000000000000000630c8ebc,\n0x\n0000000000000000000000000000000000000000000000000000000000000002\n0000000000000000000000005b38da6a701c568545dcfcb03fcb875f56beddc4\n00000000000000000000000000000000000000000000000000000000630c8ebc\n")])])])])]),e._v(" "),t("h2",{attrs:{id:"ğŸ†—-å®æˆ˜åº”ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ†—-å®æˆ˜åº”ç”¨"}},[e._v("#")]),e._v(" ğŸ†— å®æˆ˜åº”ç”¨")]),e._v(" "),t("h2",{attrs:{id:"ï¸âƒ£-é—®ç­”é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ï¸âƒ£-é—®ç­”é¢˜"}},[e._v("#")]),e._v(" #ï¸âƒ£ é—®ç­”é¢˜")]),e._v(" "),t("ul",[t("li",[e._v("å†…éƒ¨åˆçº¦è°ƒç”¨æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ\n"),t("ul",[t("li",[t("strong",[e._v("æ–¹æ³• 1")]),e._v(": é€šè¿‡ "),t("code",[e._v("ContractName(_ads)")]),e._v(" å°†ä¼ å…¥çš„åœ°å€ï¼Œè½¬ä¸ºåˆçº¦å¯¹è±¡\n"),t("ul",[t("li",[t("code",[e._v("Test(_ads).setX(_x);")])]),e._v(" "),t("li",[e._v("å¦‚æœä¸ºäº†ä»£ç é€»è¾‘ï¼Œä¹Ÿå¯ä»¥åˆ†å¼€å†™ï¼Œæ¯”å¦‚"),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Test temp = Test(_ads);\ntemp.setX(_x);\n")])])])])])]),e._v(" "),t("li",[t("strong",[e._v("æ–¹æ³• 2")]),e._v(": å¯ä»¥é€šè¿‡å‚æ•°ä¸­æŒ‡å®šåˆçº¦åå­—è¿›è¡Œè½¬æ¢"),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("  function setX2(Test _ads, uint256 _x) public {\n      _ads.setX(_x);\n  }\n")])])])]),e._v(" "),t("li",[t("strong",[e._v("è°ƒç”¨å¹¶å‘é€ ETH")]),e._v(": "),t("code",[e._v("fnName{value: msg.value}();")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Test(_ads).setYBySendEth{value: msg.value}();")])])])])])]),e._v(" "),t("li",[e._v("è°ƒç”¨å¤–éƒ¨åˆçº¦æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ\n"),t("ul",[t("li",[e._v("1 é€šè¿‡æ¥å£æ–¹å¼è°ƒç”¨")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("  interface AnimalEat {\n      function eat() external returns (string memory);\n  }\n\n  contract Animal {\n      function test(address _addr) external returns (string memory) {\n          AnimalEat general = AnimalEat(_addr);\n          return general.eat();\n      }\n  }\n")])])]),t("ul",[t("li",[e._v("2 é€šè¿‡ç­¾åæ–¹å¼è°ƒç”¨(call/delegatecall/staticcall)\n"),t("ul",[t("li",[t("strong",[e._v("call æ ¸å¿ƒä»£ç å¦‚ä¸‹")])])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('bytes memory data = abi.encodeWithSignature(\n    "setNameAndAge(string,uint256)",\n    _name,\n    _age\n);\n(bool success, bytes memory _bys) = _ads.call{value: msg.value}(data);\nrequire(success, "Call Failed");\nbys = _bys;\n')])])]),t("ul",[t("li",[e._v("ç”¨ç»™å®šçš„æœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰å‘å‡ºä½çº§ "),t("code",[e._v("CALL")]),e._v(" è°ƒç”¨ï¼Œå¹¶"),t("strong",[e._v("è¿”å›äº¤æ˜“æˆåŠŸçŠ¶æ€å’Œè¿”å›æ•°æ®")]),e._v("ï¼ˆè°ƒç”¨åˆçº¦çš„æ–¹æ³•å¹¶è½¬è´¦ï¼‰, æ ¼å¼å¦‚ä¸‹ï¼š")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("<address>.call(bytes memory) returns (bool, bytes memory)\n")])])]),t("ul",[t("li",[t("p",[t("strong",[e._v("DelegateCall æ ¸å¿ƒä»£ç å¦‚ä¸‹")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('function set(address _ads, uint256 _num) external payable {\n    sender = msg.sender;\n    value = msg.value;\n    num = _num;\n    // ç¬¬1ç§ encode\n    // ä¸éœ€çŸ¥é“åˆçº¦åå­—ï¼Œå‡½æ•°å®Œå…¨è‡ªå®šä¹‰\n    bytes memory data1 = abi.encodeWithSignature("set(uint256)", _num);\n    // ç¬¬2ç§ encode\n    // éœ€è¦åˆçº¦åå­—ï¼Œå¯ä»¥é¿å…å‡½æ•°å’Œå‚æ•°å†™é”™\n    // bytes memory data2 = abi.encodeWithSelector(Test1.set.selector, _num);\n\n    (bool success, bytes memory _data) = _ads.delegatecall(data1);\n\n    require(success, "DelegateCall set failed");\n}\n')])])])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("staticcall æ ¸å¿ƒä»£ç å¦‚ä¸‹")]),e._v(": å®ƒä¸ call åŸºæœ¬ç›¸åŒï¼Œ"),t("strong",[e._v("ä½†å¦‚æœè¢«è°ƒç”¨çš„å‡½æ•°ä»¥ä»»ä½•æ–¹å¼ä¿®æ”¹çŠ¶æ€å˜é‡ï¼Œéƒ½å°†å›é€€")]),e._v("ã€‚")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('  // SPDX-License-Identifier: MIT\n  pragma solidity ^0.8.17;\n\n  // è¢«è°ƒç”¨çš„åˆçº¦\n  contract Hello {\n      function echo() external pure returns (string memory) {\n          return "Hello World!";\n      }\n  }\n\n  // è°ƒç”¨è€…åˆçº¦\n  contract SoldityTest {\n      function callHello(address _ads) external view returns (string memory) {\n          // ç¼–ç è¢«è°ƒç”¨è€…çš„æ–¹æ³•ç­¾å\n          bytes4 methodId = bytes4(keccak256("echo()"));\n\n          // è°ƒç”¨åˆçº¦\n          (bool success, bytes memory data) = _ads.staticcall(\n              abi.encodeWithSelector(methodId)\n          );\n          if (success) {\n              return abi.decode(data, (string));\n          } else {\n              return "error";\n          }\n      }\n  }\n')])])])])])])])]),e._v(" "),t("li",[e._v("MultiCall/å¤šæ¬¡è°ƒç”¨\n"),t("ul",[t("li",[e._v("æŠŠå¤šä¸ªåˆçº¦çš„å¤šæ¬¡å‡½æ•°çš„è°ƒç”¨ï¼Œæ‰“åŒ…åœ¨ä¸€ä¸ªé‡Œé¢å¯¹åˆçº¦è¿›è¡Œè°ƒç”¨ã€‚RPC å¯¹è°ƒç”¨æœ‰é™åˆ¶ï¼Œè¿™æ ·å¯ä»¥ç»•å¼€é™åˆ¶ã€‚")]),e._v(" "),t("li",[e._v("å¤šæ¬¡è°ƒç”¨é‡Œé¢ï¼Œå¯¹æ–¹çš„å†…éƒ¨, "),t("code",[e._v("msg.sender")]),e._v(" æ˜¯ MultiCall åˆçº¦ï¼Œè€Œä¸æ˜¯ç”¨æˆ·åœ°å€ã€‚")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('contract MultiCall {\n      function multiCall(address[] calldata targets, bytes[] calldata data)\n          external\n          view\n          returns (bytes[] memory)\n      {\n          require(targets.length == data.length, "targets.length != data.length");\n          bytes[] memory results = new bytes[](data.length);\n          for (uint256 index = 0; index < targets.length; index++) {\n              (bool success, bytes memory result) = targets[index].staticcall(\n                  data[index]\n              );\n              require(success, "call faild");\n              results[index] = result;\n          }\n          return results;\n      }\n  }\n')])])])]),e._v(" "),t("li",[e._v("MultiDelegatecall / å¤šæ¬¡å§”æ‰˜è°ƒç”¨\n"),t("ul",[t("li",[e._v("ä¸ºä»€ä¹ˆä½¿ç”¨ MultiDelegatecall ï¼Œä¸ä½¿ç”¨ MultiCall?æ˜¯ä¸ºäº†è®©è¢«è°ƒç”¨çš„åˆçº¦å†…ï¼Œ"),t("code",[e._v("msg.sender")]),e._v(" æ˜¯ç”¨æˆ·åˆçº¦ï¼Œè€Œä¸æ˜¯ä¸­è½¬åˆçº¦çš„åœ°å€ã€‚ä½†æ˜¯å§”æ‰˜è°ƒç”¨çš„ç¼ºç‚¹æ˜¯ï¼Œåˆçº¦å¿…é¡»æ˜¯è‡ªå·±ç¼–å†™çš„ï¼Œä¸èƒ½æ˜¯åˆ«äººç¼–å†™çš„ã€‚å¤šæ¬¡å§”æ‰˜è°ƒç”¨ï¼Œå­˜åœ¨æ¼æ´ï¼Œä¸è¦åœ¨é‡Œé¢å¤šæ¬¡ç´¯åŠ ä½™é¢ã€‚æˆ–è€…å¤šé‡å§”æ‰˜ç¦æ­¢æ¥å—èµ„é‡‘ã€‚"),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('// SPDX-License-Identifier: MIT\npragma solidity ^0.8.17;\n\ncontract MultiDelegatecall {\n    function multiDelegatecall(bytes[] calldata data)\n        external\n        returns (bytes[] memory)\n    {\n        bytes[] memory results = new bytes[](data.length);\n        for (uint256 index = 0; index < data.length; index++) {\n            (bool success, bytes memory result) = address(this).delegatecall(\n                data[index]\n            );\n            require(success, "call faild");\n            results[index] = result;\n        }\n        return results;\n    }\n}\n\ncontract Test is MultiDelegatecall {\n    function fn1()\n        external\n        view\n        returns (\n            uint256,\n            address,\n            uint256\n        )\n    {\n        return (1, msg.sender, block.timestamp);\n    }\n\n    function fn2()\n        external\n        view\n        returns (\n            uint256,\n            address,\n            uint256\n        )\n    {\n        return (2, msg.sender, block.timestamp);\n    }\n\n    function getFn1Data() external pure returns (bytes memory) {\n        // ä¸¤ç§ç­¾åæ–¹æ³•éƒ½å¯ä»¥\n        // abi.encodeWithSignature("fn1()");\n        return abi.encodeWithSelector(this.fn1.selector);\n    }\n\n    function getFn2Data() external pure returns (bytes memory) {\n        return abi.encodeWithSelector(this.fn2.selector);\n    }\n}\n')])])])])])])])])}),[],!1,null,null,null);t.default=s.exports}}]);